# 動畫狀態機設置指南

本指南將幫助您在 Unity 編輯器中完善角色的動畫狀態機，確保所有動畫都能正確轉換。

## 前置準備

1. 打開 Unity 編輯器
2. 在 Project 視窗中找到 `Assets/Animation/Move.controller`
3. 雙擊打開 Animator 視窗

## 動畫狀態機結構

您的動畫狀態機包含以下狀態：
- **idle** (骨架|idle) - 待機動畫
- **walk_cycle** (骨架|walk_cycle) - 行走循環動畫
- **Jump** (骨架|Jump) - 跳躍動畫
- **charge** (骨架|charge) - 蓄力動畫
- **land** (骨架|land) - 落地動畫
- **turnR** (骨架|turnR) - 右轉動畫
- **turnL** (骨架|turnL) - 左轉動畫

## 現有參數

動畫控制器已經有以下參數：
- **IsRunning** (Bool) - 是否在移動
- **IsJumping** (Bool) - 是否在跳躍
- **IsCharging** (Bool) - 是否在蓄力

## 需要添加的轉換

### 1. 落地動畫轉換

#### 從 Jump 到 land
1. 在 Animator 視窗中，點擊 **Jump** 狀態
2. 右鍵點擊 **Jump** 狀態，選擇 **Make Transition**
3. 拖動箭頭到 **land** 狀態
4. 點擊新創建的轉換箭頭
5. 在 Inspector 視窗中設置：
   - **Conditions**: 
     - `IsJumping` = `false` (當跳躍結束時)
   - **Has Exit Time**: ✅ 勾選
   - **Exit Time**: `0.9` (在跳躍動畫播放到 90% 時開始轉換)
   - **Transition Duration**: `0.15` (轉換持續時間 0.15 秒)
   - **Interruption Source**: `None`

#### 從 land 到 idle
1. 點擊 **land** 狀態
2. 右鍵點擊 **land** 狀態，選擇 **Make Transition**
3. 拖動箭頭到 **idle** 狀態
4. 點擊轉換箭頭，在 Inspector 中設置：
   - **Conditions**: 無（自動轉換）
   - **Has Exit Time**: ✅ 勾選
   - **Exit Time**: `0.95` (落地動畫播放到 95% 時轉換)
   - **Transition Duration**: `0.1` (快速轉換)

#### 從 land 到 walk_cycle
1. 點擊 **land** 狀態
2. 右鍵點擊 **land** 狀態，選擇 **Make Transition**
3. 拖動箭頭到 **walk_cycle** 狀態
4. 點擊轉換箭頭，在 Inspector 中設置：
   - **Conditions**: 
     - `IsRunning` = `true` (如果正在移動)
   - **Has Exit Time**: ✅ 勾選
   - **Exit Time**: `0.95`
   - **Transition Duration**: `0.1`

### 2. 轉向動畫轉換

#### 從 walk_cycle 到 turnR
1. 點擊 **walk_cycle** 狀態
2. 右鍵點擊，選擇 **Make Transition**
3. 拖動箭頭到 **turnR** 狀態
4. 點擊轉換箭頭，在 Inspector 中設置：
   - **Conditions**: 無（由腳本直接觸發）
   - **Has Exit Time**: ❌ 不勾選（立即轉換）
   - **Transition Duration**: `0.1`

#### 從 walk_cycle 到 turnL
1. 點擊 **walk_cycle** 狀態
2. 右鍵點擊，選擇 **Make Transition**
3. 拖動箭頭到 **turnL** 狀態
4. 點擊轉換箭頭，在 Inspector 中設置：
   - **Conditions**: 無（由腳本直接觸發）
   - **Has Exit Time**: ❌ 不勾選
   - **Transition Duration**: `0.1`

#### 從 turnR 到 walk_cycle
1. 點擊 **turnR** 狀態
2. 右鍵點擊，選擇 **Make Transition**
3. 拖動箭頭到 **walk_cycle** 狀態
4. 點擊轉換箭頭，在 Inspector 中設置：
   - **Conditions**: 
     - `IsRunning` = `true` (如果正在移動)
   - **Has Exit Time**: ✅ 勾選
   - **Exit Time**: `0.9` (轉向動畫播放到 90% 時轉換)
   - **Transition Duration**: `0.1`

#### 從 turnR 到 idle
1. 點擊 **turnR** 狀態
2. 右鍵點擊，選擇 **Make Transition**
3. 拖動箭頭到 **idle** 狀態
4. 點擊轉換箭頭，在 Inspector 中設置：
   - **Conditions**: 
     - `IsRunning` = `false` (如果停止移動)
   - **Has Exit Time**: ✅ 勾選
   - **Exit Time**: `0.9`
   - **Transition Duration**: `0.1`

#### 從 turnL 到 walk_cycle
1. 點擊 **turnL** 狀態
2. 右鍵點擊，選擇 **Make Transition**
3. 拖動箭頭到 **walk_cycle** 狀態
4. 點擊轉換箭頭，在 Inspector 中設置：
   - **Conditions**: 
     - `IsRunning` = `true`
   - **Has Exit Time**: ✅ 勾選
   - **Exit Time**: `0.9`
   - **Transition Duration**: `0.1`

#### 從 turnL 到 idle
1. 點擊 **turnL** 狀態
2. 右鍵點擊，選擇 **Make Transition**
3. 拖動箭頭到 **idle** 狀態
4. 點擊轉換箭頭，在 Inspector 中設置：
   - **Conditions**: 
     - `IsRunning` = `false`
   - **Has Exit Time**: ✅ 勾選
   - **Exit Time**: `0.9`
   - **Transition Duration**: `0.1`

### 3. 完善現有轉換

#### 確保 charge 動畫可以從 idle 觸發
1. 檢查 **idle** 到 **charge** 的轉換是否存在
2. 如果不存在，創建轉換：
   - **Conditions**: 
     - `IsCharging` = `true`
   - **Has Exit Time**: ❌ 不勾選（立即響應）
   - **Transition Duration**: `0.15`

#### 確保 charge 動畫可以從 walk_cycle 觸發
1. 檢查 **walk_cycle** 到 **charge** 的轉換是否存在（應該已經存在）
2. 確認設置：
   - **Conditions**: 
     - `IsCharging` = `true`
   - **Has Exit Time**: ✅ 勾選
   - **Exit Time**: `0.7` (在行走動畫的合適時機轉換)
   - **Transition Duration**: `0.25`

#### 確保 charge 動畫可以從 Jump 觸發
1. 檢查 **Jump** 到 **charge** 的轉換是否存在
2. 如果不存在，創建轉換：
   - **Conditions**: 
     - `IsCharging` = `true`
   - **Has Exit Time**: ❌ 不勾選（空中也可以蓄力）
   - **Transition Duration**: `0.2`

## 轉換優先級設置

為了確保轉換正確執行，需要設置轉換的優先級（通過調整轉換在列表中的順序）：

1. 在 Animator 視窗中，點擊一個狀態
2. 在 Inspector 視窗中，您會看到該狀態的所有轉換列表
3. 使用列表右上角的上下箭頭調整轉換順序
4. **優先級順序**（從高到低）：
   - **charge** 相關轉換（最高優先級）
   - **Jump** 相關轉換
   - **land** 相關轉換
   - **turnR/turnL** 相關轉換
   - **walk_cycle/idle** 之間的轉換（最低優先級）

## 動畫設置檢查清單

- [ ] 所有動畫狀態都已正確連接到 Entry
- [ ] idle 是默認狀態（橙色顯示）
- [ ] 所有轉換都已設置正確的條件
- [ ] 轉換的優先級已正確設置
- [ ] Has Exit Time 設置正確（轉向動畫不勾選，其他根據需要）
- [ ] Transition Duration 設置合理（0.1-0.25 秒）

## 測試建議

1. **測試待機和移動**：
   - 角色應該在 idle 和 walk_cycle 之間平滑轉換

2. **測試跳躍和落地**：
   - 跳躍時應該播放 Jump 動畫
   - 落地時應該播放 land 動畫
   - 落地後根據移動狀態切換到 idle 或 walk_cycle

3. **測試蓄力**：
   - 在任何狀態下按住跳躍鍵，應該切換到 charge 動畫
   - 鬆開跳躍鍵後，應該切換到 Jump 動畫

4. **測試轉向**：
   - 在移動時快速改變方向，應該觸發 turnR 或 turnL 動畫
   - 轉向動畫播放完成後，應該根據移動狀態切換到 walk_cycle 或 idle

## 常見問題

### Q: 轉向動畫不播放？
A: 檢查 `PlayerAnimationController` 組件中的 `turnAngleThreshold` 參數，確保角度閾值設置合理（建議 45 度）。

### Q: 落地動畫不播放？
A: 確保 Jump 到 land 的轉換條件正確設置，並且 `IsJumping` 參數在落地時正確設置為 `false`。

### Q: 蓄力動畫不響應？
A: 確保 `IsCharging` 參數正確設置，並且轉換的優先級足夠高。

### Q: 動畫切換不流暢？
A: 調整 Transition Duration 值，較小的值（0.1）會讓切換更快，較大的值（0.25）會讓切換更平滑。

## 腳本設置

確保您的角色 GameObject 上有以下組件：
- `PlayerMove` - 處理移動和跳躍邏輯
- `CharacterStateMachine` - 管理狀態機
- `PlayerAnimationController` - 控制動畫切換
- `Animator` - Unity 動畫組件，使用 `Move.controller`

在 `Animator` 組件中：
- **Controller**: 設置為 `Move.controller`
- **Avatar**: 設置為角色的 Avatar（如果有）

## 完成後

完成所有設置後，您的動畫狀態機應該能夠：
- ✅ 正確處理待機和移動動畫
- ✅ 正確處理跳躍和落地動畫
- ✅ 正確處理蓄力動畫
- ✅ 正確處理轉向動畫（左右切換）
- ✅ 所有動畫之間平滑轉換

祝您設置順利！

